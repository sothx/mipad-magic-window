import{d as e,L as t,r as l,b as a,V as n,b9 as s,ba as o,bb as r,bj as i,bh as u,J as d,be as c,F as p,cB as m,c as g,bf as v,bg as b,bi as f,k as h,v as y,d1 as w}from"./apis-ClapPSWe.js";import{ay as S,aC as I,aB as k,aV as x}from"./hooks-RZQ5oMJE.js";import{R as O}from"./RenderJSX-CO6Pk8ZF.js";import{r as B,a as D}from"./XCircleIcon-CDs2_JW5.js";import"./lodash-CIZQSGu2.js";const C={class:"memoryHealth"},F={class:"mt-3"},M={class:"px-3 sm:px-0"},E={class:"flex"},L=e({__name:"MemoryHealth",setup(e){const L=t(),_=S(),z=I(),R=k(),U=x(),A=l(""),V=l(null),j=({focused:e,checked:t})=>{const l={};return t?(l.background="#d03050",e&&(l.boxShadow="0 0 0 2px #d0305040")):(l.background="#2080f0",e&&(l.boxShadow="0 0 0 2px #2080f040")),l},T=[{title:"设备DDR和UFS信息",content:()=>n("div",{class:"whitespace-pre"},[L.deviceInfo.memoryInfo||"获取失败"]),isShow:()=>Boolean(L.deviceInfo.memoryInfo)},{title:"设备DDR生产厂商",content:()=>n("div",{class:"whitespace-pre"},[L.DDRVendor]),isShow:()=>Boolean(L.DDRVendor)},{title:"ZRAM Writeback",content:()=>n(p,null,[n("div",{class:"mb-3"},[n(s("n-tag"),null,{default:()=>[g("dm设备映射器: "),_.miuiExtmDmOptEnable.value?"已生效":"未生效"]})]),n("div",{class:"mb-3"},[n(s("n-tag"),{type:"error"},{default:()=>[g("回写块: "),_.backingDev.value,g(" ")]})]),n("div",{class:"mb-3"},[n(s("n-tag"),{type:"success"},{default:()=>[g("已回写: "),_.hasWriteBack.value,g(" MB")]})]),n("div",{class:"mb-3"},[n(s("n-tag"),{type:"info"},{default:()=>[g("总读取: "),_.totalRead.value,g(" MB")]})]),n("div",null,[n(s("n-tag"),{type:"warning"},{default:()=>[g("总回写: "),_.totalWriteBack.value,g(" MB")]})]),n(s("n-alert"),{class:"mt-5",type:"warning","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("通常用于将设备上的冷数据压缩并迁移到磁盘上，是基于「内存扩展」的回写块，该功能依赖「内存扩展」，请确保已经开启「内存扩展」，总回写可以大于「内存扩展」，初始状态下显示 0 MB是正常现象，请持续使用一段时间再观察是否有变化")])]})]),isShow:()=>Boolean(L.MIOSVersion&&L.MIOSVersion>=2&&L.androidTargetSdk>=35&&_.isInit.value)},{title:"智能IO调度",content:()=>{const e=(()=>{const e=R.currentScheduler.value,t=R.smartFocusIO.value,l=R.currentPropScheduler.value;return"cpq"===e?"success":"on"===t&&l&&"cpq"!==l?"warning":"error"})();return n(p,null,[n(s("n-tag"),{type:e},{default:()=>["success"===e?"已启用智能IO调度 [cpq]":"warning"===e?`已被模块磁盘IO调度覆盖 [${R.currentScheduler.value}]`:"未启用智能IO调度"]}),n(s("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("「智能IO调度 cpq」是小米基于「Linux磁盘IO调度 bfq」二次优化改进的版本，一般情况下建议启用，可以一定程度提升系统的IO性能体验。")])]}),R.isNeedShowModuleTips.value&&n(s("n-alert"),{class:"mt-5",type:"warning","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("您当前未启用「智能IO调度」，由于小米「磁盘IO调度」BUG，骁龙8+Gen1机型存在IO调度异常的问题， 容易导致系统卡顿或者无响应，您可以通过安装「精选应用-系统功能补全模块」来启用「智能IO调度」，提升系统IO性能体验。")])]})])},isShow:()=>Boolean(R.isSupportSmartFocusIO.value)},{title:"磁盘IO调度策略",content:()=>n(p,null,[n("div",{class:"grid grid-cols-2 gap-4 sm:px-0"},[Array.isArray(R.schedulerList.value)&&R.schedulerList.value.map((e,t)=>{const l=e=>{const t=R.currentScheduler.value,l=R.currentPropScheduler.value;return l||t!==e?l===e&&t===e?"success":l&&t&&l!==t&&t===e?"warning":"info":"error"},a=l(e);return n(s("n-alert"),{size:"small","show-icon":!1,type:l(e),title:e,class:"w-full"},{default:()=>[["error"].includes(a)?n(s("n-tag"),{class:"mt-2",bordered:!1,type:a},{default:()=>[n("div",null,[g("系统默认磁盘调度")])]}):h(n(s("n-button"),{class:"mt-2",strong:!0,secondary:!0,type:a,loading:L.loading||R.loading.value,size:"small",onClick:()=>R.changeIOScheduler(e)},{default:()=>["success"===a?"已应用该配置":"warning"===a?"异常的磁盘调度":"应用配置"]}),[[y,R.isInit.value]])]})})]),n(s("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("这里会显示系统所支持的所有磁盘IO调度策略，方便您灵活切换设备的磁盘IO调度策略")]),n("p",null,[g("(受系统实际支持情况影响，切换其他磁盘IO调度策略可能会导致系统出现未知异常，请自行准备救砖模块)")])]})]),isShow:()=>Boolean(R.isShowList.value)},{title:"UFS 存储健康",content:()=>n(p,null,[n("div",{class:"mb-3"},[z.correctedPreEOLStatus.value&&n("div",{class:"mb-3"},[n(s("n-tag"),{type:"info"},{default:()=>[g("寿命阶段: "),z.correctedPreEOLStatus.value]})]),z.deviceLifeTimeEstA.value&&n("div",{class:"mb-3"},[n(s("n-tag"),{type:"success"},{default:()=>[g("用户数据区(已磨损): "),z.deviceLifeTimeEstA.value]})]),z.deviceLifeTimeEstB.value&&n("div",{class:"mb-3"},[n(s("n-tag"),{type:"warning"},{default:()=>[g("高速缓存区(已磨损): "),z.deviceLifeTimeEstB.value]})])]),n(s("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("数据仅供参考，通常仅代表当前 UFS 存储设备循环擦写次数与预期设计寿命的比值，不代表 UFS 存储设备的实际磨损状况，但仍然建议当前 UFS 存储设备接近预期设计寿命时选择更换存储设备。")])]})]),isShow:()=>Boolean(z.isShow.value)},{title:"焕新存储",content:()=>n(p,null,[n(s("n-button"),{size:"small",type:"info",secondary:!0,loading:L.loading,onClick:()=>w()},{default:()=>[g("打开 焕新存储信息面板")]}),n(s("n-alert"),{class:"mb-5 mt-5",type:"success","show-icon":!1,bordered:!1},{default:()=>[n("div",null,[n("p",null,[g("焕新存储启用状态:"),n(s("n-button"),{size:"tiny",class:"ml-3",type:U.fboEnable.value?"success":"error",loading:L.loading,onClick:()=>U.handleEnableFbo()},{default:()=>[U.fboEnable.value?"已启用":"未启用(点击启用)"]})]),n("p",null,[g("启用状态通常由小米云控控制，模块支持强制启用焕新存储，但该功能受系统底层支持情况而异，不支持的设备即使启用也不会生效。")]),n(s("n-switch"),{onUpdateValue:e=>U.changeIsAutoEnableFbo(e),"rail-style":j,value:!!U.isAutoStartFbo.value,loading:L.loading},{checked:()=>n(p,null,[g("已强制启用焕新存储")]),unchecked:()=>n(p,null,[g("跟随系统默认云控规则")])})])]}),n(s("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("焕新存储激活状态:"),n(s("n-button"),{size:"tiny",class:"ml-3",type:U.fboServiceCtrl.value?"success":"error",loading:L.loading,onClick:()=>U.handleEnableFboServiceCtrl()},{default:()=>[U.fboServiceCtrl.value?"已激活":"未激活(点击激活)"]})]),U.fboInstalld.value&&n("p",{class:"mt-1"},[g("焕新存储运行状态:"),n(s("n-tag"),{size:"small",class:"ml-3",type:"info",loading:L.loading,onClick:()=>{}},{default:()=>[U.fboInstalld.value]})]),n("p",null,[g("激活后仍然需要满足以下条件才会在特定时间触发焕新存储：")]),n("p",null,[g("①夜间12点半-凌晨5点")]),n("p",null,[g("②息屏状态")]),n("p",null,[g("③电量大于75%(或保持手机充电)")]),n("p",null,[g("④电池温度小于40℃")]),n("p",null,[g("进行焕新存储期间检测到其中任意条件不满足，焕新存储会被中断，待满足后继续执行，当满足上述4个条件后，此功能也并不是每天都生效，需要文件碎片累积到一定程度会主动进行。")]),n("p",null,[g("（焕新存储流程结束后，激活状态会被关闭，您可以前往Web UI 重新激活）")]),n(s("n-switch"),{onUpdateValue:e=>U.changeIsAutoRegularlyFbo(e),"rail-style":j,value:!!U.isAutoRegularlyFbo.value,loading:L.loading},{checked:()=>n(p,null,[g("已启用每日闲时维护")]),unchecked:()=>n(p,null,[g("未启用每日闲时维护")])})]})]),isShow:()=>Boolean(U.isInit.value)}],q=a(()=>{const e=A.value.trim().toLowerCase();return T.filter(t=>!(t.isShow&&!t.isShow())&&(!e||t.title.toLowerCase().includes(e)))});return(e,t)=>{const l=s("n-input"),a=s("n-icon"),h=s("n-button"),y=s("n-input-group"),w=s("n-card");return r(),o("div",C,[i("div",F,[i("div",M,[t[3]||(t[3]=i("h3",{class:u("text-base font-semibold leading-7")},[i("span",{class:"animated-bg bg-clip-text font-semibold text-transparent",style:{"background-image":"linear-gradient(\r\n\t\t\t\t\t\t\t\t101.22deg,\r\n\t\t\t\t\t\t\t\trgb(255, 182, 133) -18.32%,\r\n\t\t\t\t\t\t\t\trgb(255, 111, 29) 7.01%,\r\n\t\t\t\t\t\t\t\trgb(252, 181, 232) 41.59%,\r\n\t\t\t\t\t\t\t\trgb(135, 148, 255) 70.98%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 91.35%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 110.17%\r\n\t\t\t\t\t\t\t)"}},"存储健康")],-1)),i("p",{class:u("mt-1 max-w-2xl text-sm leading-6 "+(d(L).isDarkMode?"text-gray-300":"text-gray-500"))}," 存储健康，提供存储状态监测与优化管理。 ",2)]),n(w,{size:"small",class:"mt-5"},{default:c(()=>[i("div",E,[n(y,null,{default:c(()=>[n(l,{size:"large",clearable:"",value:A.value,"onUpdate:value":t[0]||(t[0]=e=>A.value=e),ref_key:"searchKeyWordInput",ref:V,placeholder:"搜索功能名称",class:"w-4/5"},null,8,["value"]),n(h,{size:"large",type:"primary",onClick:t[1]||(t[1]=()=>{V.value?.blur()})},{icon:c(()=>[n(a,null,{default:c(()=>[n(d(B))]),_:1})]),default:c(()=>[t[4]||(t[4]=i("span",{class:"hidden sm:inline-block"},"搜索",-1))]),_:1,__:[4]}),n(h,{size:"large",bordered:"",onClick:t[2]||(t[2]=()=>{A.value=""})},{icon:c(()=>[n(a,null,{default:c(()=>[n(d(D))]),_:1})]),default:c(()=>[t[5]||(t[5]=i("span",{class:"hidden sm:inline-block"},"清空",-1))]),_:1,__:[5]})]),_:1})])]),_:1}),i("div",{class:u("mt-3 border-t "+(d(L).isDarkMode?"divide-sothx-gray-color border-sothx-gray-color":"divide-gray-200 border-gray-200"))},[i("dl",{class:u("divide-y "+(d(L).isDarkMode?"divide-sothx-gray-color":"divide-gray-200"))},[(r(!0),o(p,null,m(q.value,(e,t)=>(r(),o("div",{key:t,class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},[i("dt",{class:u("text-sm font-medium leading-6 "+(d(L).isDarkMode?"text-white":"text-gray-900"))},[g(f(e.title)+" ",1),e.titleSlot?(r(),v(d(O),{key:0,content:e.titleSlot&&e.titleSlot()},null,8,["content"])):b("",!0)],2),i("dd",{class:u(`mt-1 text-sm leading-6 ${d(L).isDarkMode?"text-gray-300":"text-gray-700"} sm:col-span-2 sm:mt-0`)},[e.content?(r(),v(d(O),{key:0,content:e.content&&e.content()},null,8,["content"])):b("",!0)],2)]))),128))],2)],2)])])}}});export{L as default};
