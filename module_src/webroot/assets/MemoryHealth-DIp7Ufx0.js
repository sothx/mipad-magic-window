import{d as e,L as t,r as l,b as a,aJ as n,aK as s,aL as o,aT as i,aP as r,J as d,M as c,aO as u,F as m,bw as v,c as g,aS as p,aQ as b,aR as f,c5 as y}from"./apis-AJ0ovKP0.js";import{ay as h,aB as k,aK as x}from"./hooks-D6OHrZ_8.js";import{R as S}from"./RenderJSX-DN2yxmX0.js";import{r as w,a as D}from"./XCircleIcon-DZJkl1hA.js";import"./lodash-DMrPhC4V.js";const I={class:"memoryHealth"},B={class:"mt-3"},M={class:"px-3 sm:px-0"},E={class:"flex"},C=e({__name:"MemoryHealth",setup(e){const C=t(),F=h(),R=k(),L=x(),U=l(""),_=l(null),z=({focused:e,checked:t})=>{const l={};return t?(l.background="#d03050",e&&(l.boxShadow="0 0 0 2px #d0305040")):(l.background="#2080f0",e&&(l.boxShadow="0 0 0 2px #2080f040")),l},A=[{title:"设备DDR和UFS信息",content:()=>c("div",{class:"whitespace-pre"},[C.deviceInfo.memoryInfo||"获取失败"]),isShow:()=>Boolean(C.deviceInfo.memoryInfo)},{title:"设备DDR生产厂商",content:()=>c("div",{class:"whitespace-pre"},[C.DDRVendor]),isShow:()=>Boolean(C.DDRVendor)},{title:"ZRAM Writeback",content:()=>c(m,null,[c("div",{class:"mb-3"},[c(n("n-tag"),null,{default:()=>[g("dm设备映射器: "),F.miuiExtmDmOptEnable.value?"启用":"未启用"]})]),c("div",{class:"mb-3"},[c(n("n-tag"),{type:"error"},{default:()=>[g("回写块: "),F.backingDev.value,g(" ")]})]),c("div",{class:"mb-3"},[c(n("n-tag"),{type:"success"},{default:()=>[g("已回写: "),F.hasWriteBack.value,g(" MB")]})]),c("div",{class:"mb-3"},[c(n("n-tag"),{type:"info"},{default:()=>[g("总读取: "),F.totalRead.value,g(" MB")]})]),c("div",null,[c(n("n-tag"),{type:"warning"},{default:()=>[g("总回写: "),F.totalWriteBack.value,g(" MB")]})]),c(n("n-alert"),{class:"mt-5",type:"warning","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[g("通常用于将设备上的冷数据压缩并迁移到磁盘上，是基于「内存扩展」的回写块，该功能依赖「内存扩展」，请确保已经开启「内存扩展」，总回写可以大于「内存扩展」，初始状态下显示 0 MB是正常现象，请持续使用一段时间再观察是否有变化")])]})]),isShow:()=>Boolean(C.MIOSVersion&&C.MIOSVersion>=2&&C.androidTargetSdk>=35&&F.isInit.value)},{title:"UFS 存储健康",content:()=>c(m,null,[c("div",{class:"mb-3"},[R.correctedPreEOLStatus.value&&c("div",{class:"mb-3"},[c(n("n-tag"),{type:"info"},{default:()=>[g("寿命阶段: "),R.correctedPreEOLStatus.value]})]),R.deviceLifeTimeEstA.value&&c("div",{class:"mb-3"},[c(n("n-tag"),{type:"success"},{default:()=>[g("用户数据区(已磨损): "),R.deviceLifeTimeEstA.value]})]),R.deviceLifeTimeEstB.value&&c("div",{class:"mb-3"},[c(n("n-tag"),{type:"warning"},{default:()=>[g("高速缓存区(已磨损): "),R.deviceLifeTimeEstB.value]})])]),c(n("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[g("数据仅供参考，通常仅代表当前 UFS 存储设备循环擦写次数与预期设计寿命的比值，不代表 UFS 存储设备的实际磨损状况，但仍然建议当前 UFS 存储设备接近预期设计寿命时选择更换存储设备。")])]})]),isShow:()=>Boolean(R.isShow.value)},{title:"焕新存储",content:()=>c(m,null,[c(n("n-button"),{size:"small",type:"info",secondary:!0,loading:C.loading,onClick:()=>y()},{default:()=>[g("打开 焕新存储信息面板")]}),c(n("n-alert"),{class:"mb-5 mt-5",type:"success","show-icon":!1,bordered:!1},{default:()=>[c("div",null,[c("p",null,[g("焕新存储启用状态:"),c(n("n-button"),{size:"tiny",class:"ml-3",type:L.fboEnable.value?"success":"error",loading:C.loading,onClick:()=>L.handleEnableFbo()},{default:()=>[L.fboEnable.value?"已启用":"未启用(点击启用)"]})]),c("p",null,[g("启用状态通常由小米云控控制，模块支持强制启用焕新存储，但该功能受系统底层支持情况而异，不支持的设备即使启用也不会生效。")]),c(n("n-switch"),{onUpdateValue:e=>L.changeIsAutoEnableFbo(e),"rail-style":z,value:!!L.isAutoStartFbo.value,loading:C.loading},{checked:()=>c(m,null,[g("已强制启用焕新存储")]),unchecked:()=>c(m,null,[g("跟随系统默认云控规则")])})])]}),c(n("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[g("焕新存储激活状态:"),c(n("n-button"),{size:"tiny",class:"ml-3",type:L.fboServiceCtrl.value?"success":"error",loading:C.loading,onClick:()=>L.handleEnableFboServiceCtrl()},{default:()=>[L.fboServiceCtrl.value?"已激活":"未激活(点击激活)"]})]),L.fboInstalld.value&&c("p",{class:"mt-1"},[g("焕新存储运行状态:"),c(n("n-tag"),{size:"small",class:"ml-3",type:"info",loading:C.loading,onClick:()=>{}},{default:()=>[L.fboInstalld.value]})]),c("p",null,[g("激活后仍然需要满足以下条件才会在特定时间触发焕新存储：")]),c("p",null,[g("①夜间12点半-凌晨5点")]),c("p",null,[g("②息屏状态")]),c("p",null,[g("③电量大于75%(或保持手机充电)")]),c("p",null,[g("④电池温度小于40℃")]),c("p",null,[g("进行焕新存储期间检测到其中任意条件不满足，焕新存储会被中断，待满足后继续执行，当满足上述4个条件后，此功能也并不是每天都生效，需要文件碎片累积到一定程度会主动进行。")]),c("p",null,[g("（焕新存储流程结束后，激活状态会被关闭，您可以前往Web UI 重新激活）")]),c(n("n-switch"),{onUpdateValue:e=>L.changeIsAutoRegularlyFbo(e),"rail-style":z,value:!!L.isAutoRegularlyFbo.value,loading:C.loading},{checked:()=>c(m,null,[g("已启用每日闲时维护")]),unchecked:()=>c(m,null,[g("未启用每日闲时维护")])})]})]),isShow:()=>Boolean(L.isInit.value)}],O=a((()=>{const e=U.value.trim().toLowerCase();return A.filter((t=>!(t.isShow&&!t.isShow())&&(!e||t.title.toLowerCase().includes(e))))}));return(e,t)=>{const l=n("n-input"),a=n("n-icon"),y=n("n-button"),h=n("n-input-group"),k=n("n-card");return s(),o("div",I,[i("div",B,[i("div",M,[t[3]||(t[3]=i("h3",{class:r("text-base font-semibold leading-7")},[i("span",{class:"animated-bg bg-clip-text font-semibold text-transparent",style:{"background-image":"linear-gradient(\r\n\t\t\t\t\t\t\t\t101.22deg,\r\n\t\t\t\t\t\t\t\trgb(255, 182, 133) -18.32%,\r\n\t\t\t\t\t\t\t\trgb(255, 111, 29) 7.01%,\r\n\t\t\t\t\t\t\t\trgb(252, 181, 232) 41.59%,\r\n\t\t\t\t\t\t\t\trgb(135, 148, 255) 70.98%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 91.35%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 110.17%\r\n\t\t\t\t\t\t\t)"}},"存储健康")],-1)),i("p",{class:r("mt-1 max-w-2xl text-sm leading-6 "+(d(C).isDarkMode?"text-gray-300":"text-gray-500"))}," 存储健康，提供存储状态监测与优化管理。 ",2)]),c(k,{size:"small",class:"mt-5"},{default:u((()=>[i("div",E,[c(h,null,{default:u((()=>[c(l,{size:"large",clearable:"",value:U.value,"onUpdate:value":t[0]||(t[0]=e=>U.value=e),ref_key:"searchKeyWordInput",ref:_,placeholder:"搜索功能名称",class:"w-4/5"},null,8,["value"]),c(y,{size:"large",type:"primary",onClick:t[1]||(t[1]=()=>{var e;null==(e=_.value)||e.blur()})},{icon:u((()=>[c(a,null,{default:u((()=>[c(d(w))])),_:1})])),default:u((()=>[t[4]||(t[4]=i("span",{class:"hidden sm:inline-block"},"搜索",-1))])),_:1}),c(y,{size:"large",bordered:"",onClick:t[2]||(t[2]=()=>{U.value=""})},{icon:u((()=>[c(a,null,{default:u((()=>[c(d(D))])),_:1})])),default:u((()=>[t[5]||(t[5]=i("span",{class:"hidden sm:inline-block"},"清空",-1))])),_:1})])),_:1})])])),_:1}),i("div",{class:r("mt-3 border-t "+(d(C).isDarkMode?"divide-sothx-gray-color border-sothx-gray-color":"divide-gray-200 border-gray-200"))},[i("dl",{class:r("divide-y "+(d(C).isDarkMode?"divide-sothx-gray-color":"divide-gray-200"))},[(s(!0),o(m,null,v(O.value,((e,t)=>(s(),o("div",{key:t,class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},[i("dt",{class:r("text-sm font-medium leading-6 "+(d(C).isDarkMode?"text-white":"text-gray-900"))},[g(p(e.title)+" ",1),e.titleSlot?(s(),b(d(S),{key:0,content:e.titleSlot&&e.titleSlot()},null,8,["content"])):f("",!0)],2),i("dd",{class:r(`mt-1 text-sm leading-6 ${d(C).isDarkMode?"text-gray-300":"text-gray-700"} sm:col-span-2 sm:mt-0`)},[e.content?(s(),b(d(S),{key:0,content:e.content&&e.content()},null,8,["content"])):f("",!0)],2)])))),128))],2)],2)])])}}});export{C as default};
