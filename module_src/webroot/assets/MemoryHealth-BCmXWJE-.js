import{d as e,L as t,r as l,b as a,Y as n,ae as s,bi as o,bj as r,bk as i,bs as u,bq as c,J as d,bn as p,F as m,cP as v,c as g,bo as b,bp as f,br as h,k as y,v as w,di as S}from"./apis-_OpLZPT1.js";import{ay as I,aC as k,aB as x,aX as O}from"./hooks-CnCjdkLL.js";import{R as B}from"./RenderJSX-BSEAsdIM.js";import{r as D,a as C}from"./XCircleIcon-DV156BKA.js";import"./lodash-CIZQSGu2.js";const F={class:"memoryHealth"},M={class:"mt-3"},E={class:"px-3 sm:px-0"},L={class:"flex"},_=e({__name:"MemoryHealth",setup(e){const _=t(),z=I(),R=k(),U=x(),A=O(),j=l(""),q=l(null),T=({focused:e,checked:t})=>{const l={};return t?(l.background="#d03050",e&&(l.boxShadow="0 0 0 2px #d0305040")):(l.background="#2080f0",e&&(l.boxShadow="0 0 0 2px #2080f040")),l},V=[{title:"设备DDR和UFS信息",content:()=>n("div",{class:"whitespace-pre"},[_.deviceInfo.memoryInfo||"获取失败"]),isShow:()=>Boolean(_.deviceInfo.memoryInfo)},{title:"设备DDR生产厂商",content:()=>n("div",{class:"whitespace-pre"},[_.DDRVendor]),isShow:()=>Boolean(_.DDRVendor)},{title:"ZRAM Writeback",content:()=>n(m,null,[n("div",{class:"mb-3"},[n(o("n-tag"),null,{default:()=>[g("dm设备映射器: "),z.miuiExtmDmOptEnable.value?"已生效":"未生效"]})]),n("div",{class:"mb-3"},[n(o("n-tag"),{type:"error"},{default:()=>[g("回写块: "),z.backingDev.value,g(" ")]})]),n("div",{class:"mb-3"},[n(o("n-tag"),{type:"success"},{default:()=>[g("已回写: "),z.hasWriteBack.value,g(" MB")]})]),n("div",{class:"mb-3"},[n(o("n-tag"),{type:"info"},{default:()=>[g("总读取: "),z.totalRead.value,g(" MB")]})]),n("div",null,[n(o("n-tag"),{type:"warning"},{default:()=>[g("总回写: "),z.totalWriteBack.value,g(" MB")]})]),n(o("n-alert"),{class:"mt-5",type:"warning","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("通常用于将设备上的冷数据压缩并迁移到磁盘上，是基于「内存扩展」的回写块，该功能依赖「内存扩展」，请确保已经开启「内存扩展」，总回写可以大于「内存扩展」，初始状态下显示 0 MB是正常现象，请持续使用一段时间再观察是否有变化")])]})]),isShow:()=>Boolean(_.MIOSVersion&&_.MIOSVersion>=2&&_.androidTargetSdk>=35&&z.isInit.value)},{title:"智能IO调度",content:()=>{const e=(()=>{const e=U.currentScheduler.value,t=U.smartFocusIO.value,l=U.currentPropScheduler.value;return"cpq"===e?"success":"on"===t&&l&&"cpq"!==l?"warning":"error"})();return n(m,null,[n(o("n-tag"),{type:e},{default:()=>["success"===e?"已启用智能IO调度 [cpq]":"warning"===e?`已被模块磁盘IO调度覆盖 [${U.currentScheduler.value}]`:"未启用智能IO调度"]}),n(o("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("「智能IO调度 cpq」是小米基于「Linux磁盘IO调度 bfq」二次优化改进的版本，一般情况下建议启用，可以一定程度提升系统的IO性能体验。")])]}),U.isNeedShowModuleTips.value&&n(o("n-alert"),{class:"mt-5",type:"warning","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("您当前未启用「智能IO调度」，由于小米「磁盘IO调度」BUG，骁龙8+Gen1机型存在IO调度异常的问题， 容易导致系统卡顿或者无响应，您可以通过安装「精选应用-系统功能补全模块」来启用「智能IO调度」，提升系统IO性能体验。")])]})])},isShow:()=>Boolean(U.isSupportSmartFocusIO.value)},{title:"磁盘IO调度策略",content:()=>n(m,null,[n("div",{class:"grid grid-cols-2 gap-4 sm:px-0"},[Array.isArray(U.schedulerList.value)&&U.schedulerList.value.map((e,t)=>{const l=e=>{const t=U.currentScheduler.value,l=U.currentPropScheduler.value;return l||t!==e?l===e&&t===e?"success":l&&t&&l!==t&&t===e?"warning":"info":"error"},a=l(e);return n(o("n-alert"),{size:"small","show-icon":!1,type:l(e),title:e,class:"w-full"},{default:()=>[["error"].includes(a)?n(o("n-tag"),{class:"mt-2",bordered:!1,type:a},{default:()=>[n("div",null,[g("系统默认磁盘调度")])]}):y(n(o("n-button"),{class:"mt-2",strong:!0,secondary:!0,type:a,loading:_.loading||U.loading.value,size:"small",onClick:()=>U.changeIOScheduler(e)},{default:()=>["success"===a?"已应用该配置":"warning"===a?"异常的磁盘调度":"应用配置"]}),[[w,U.isInit.value]])]})})]),n(o("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("这里会显示系统所支持的所有磁盘IO调度策略，方便您灵活切换设备的磁盘IO调度策略")]),n("p",null,[g("(受系统实际支持情况影响，切换其他磁盘IO调度策略可能会导致系统出现未知异常，请自行准备救砖模块)")])]})]),isShow:()=>Boolean(U.isShowList.value)},{title:"UFS 存储健康",content:()=>n(m,null,[n("div",{class:"mb-3"},[R.correctedPreEOLStatus.value&&n("div",{class:"mb-3"},[n(o("n-tag"),{type:"info"},{default:()=>[g("寿命阶段: "),R.correctedPreEOLStatus.value]})]),R.deviceLifeTimeEstA.value&&n("div",{class:"mb-3"},[n(o("n-tag"),{type:"success"},{default:()=>[g("用户数据区(已磨损): "),R.deviceLifeTimeEstA.value]})]),R.deviceLifeTimeEstB.value&&n("div",{class:"mb-3"},[n(o("n-tag"),{type:"warning"},{default:()=>[g("高速缓存区(已磨损): "),R.deviceLifeTimeEstB.value]})])]),n(o("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("数据仅供参考，通常仅代表当前 UFS 存储设备循环擦写次数与预期设计寿命的比值，不代表 UFS 存储设备的实际磨损状况，但仍然建议当前 UFS 存储设备接近预期设计寿命时选择更换存储设备。")])]})]),isShow:()=>Boolean(R.isShow.value)},{title:"焕新存储",content:()=>n(m,null,[n(o("n-button"),{size:"small",type:"info",secondary:!0,loading:_.loading,onClick:()=>S()},{default:()=>[g("打开 焕新存储信息面板")]}),n(o("n-alert"),{class:"mb-5 mt-5",type:"success","show-icon":!1,bordered:!1},{default:()=>[n("div",null,[n("p",null,[g("焕新存储启用状态:"),n(o("n-button"),{size:"tiny",class:"ml-3",type:A.fboEnable.value?"success":"error",loading:_.loading,onClick:()=>A.handleEnableFbo()},{default:()=>[A.fboEnable.value?"已启用":"未启用(点击启用)"]})]),n("p",null,[g("启用状态通常由小米云控控制，模块支持强制启用焕新存储，但该功能受系统底层支持情况而异，不支持的设备即使启用也不会生效。")]),n(o("n-switch"),{onUpdateValue:e=>A.changeIsAutoEnableFbo(e),"rail-style":T,value:!!A.isAutoStartFbo.value,loading:_.loading},{checked:()=>n(m,null,[g("已强制启用焕新存储")]),unchecked:()=>n(m,null,[g("跟随系统默认云控规则")])})])]}),n(o("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[n("p",null,[g("焕新存储激活状态:"),n(o("n-button"),{size:"tiny",class:"ml-3",type:A.fboServiceCtrl.value?"success":"error",loading:_.loading,onClick:()=>A.handleEnableFboServiceCtrl()},{default:()=>[A.fboServiceCtrl.value?"已激活":"未激活(点击激活)"]})]),A.fboInstalld.value&&n("p",{class:"mt-1"},[g("焕新存储运行状态:"),n(o("n-tag"),{size:"small",class:"ml-3",type:"info",loading:_.loading,onClick:()=>{}},{default:()=>[A.fboInstalld.value]})]),n("p",null,[g("激活后仍然需要满足以下条件才会在特定时间触发焕新存储：")]),n("p",null,[g("①夜间12点半-凌晨5点")]),n("p",null,[g("②息屏状态")]),n("p",null,[g("③电量大于75%(或保持手机充电)")]),n("p",null,[g("④电池温度小于40℃")]),n("p",null,[g("进行焕新存储期间检测到其中任意条件不满足，焕新存储会被中断，待满足后继续执行，当满足上述4个条件后，此功能也并不是每天都生效，需要文件碎片累积到一定程度会主动进行。")]),n("p",null,[g("（焕新存储流程结束后，激活状态会被关闭，您可以前往Web UI 重新激活）")]),n(o("n-switch"),{onUpdateValue:e=>A.changeIsAutoRegularlyFbo(e),"rail-style":T,value:!!A.isAutoRegularlyFbo.value,loading:_.loading},{checked:()=>n(m,null,[g("已启用每日闲时维护")]),unchecked:()=>n(m,null,[g("未启用每日闲时维护")])})]})]),isShow:()=>Boolean(A.isInit.value)}],P=a(()=>{const e=j.value.trim().toLowerCase();return V.filter(t=>{if(!(!t.isShow||t.isShow()))return!1;if(!e)return!0;const l=t.title?.toLowerCase?.()??"";return l.includes(e)||!1!==s.match(l,e)})});return(e,t)=>{const l=o("n-input"),a=o("n-icon"),s=o("n-button"),y=o("n-input-group"),w=o("n-card");return i(),r("div",F,[u("div",M,[u("div",E,[t[3]||(t[3]=u("h3",{class:c("text-base font-semibold leading-7")},[u("span",{class:"animated-bg bg-clip-text font-semibold text-transparent",style:{"background-image":"linear-gradient(\r\n\t\t\t\t\t\t\t\t101.22deg,\r\n\t\t\t\t\t\t\t\trgb(255, 182, 133) -18.32%,\r\n\t\t\t\t\t\t\t\trgb(255, 111, 29) 7.01%,\r\n\t\t\t\t\t\t\t\trgb(252, 181, 232) 41.59%,\r\n\t\t\t\t\t\t\t\trgb(135, 148, 255) 70.98%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 91.35%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 110.17%\r\n\t\t\t\t\t\t\t)"}},"存储健康")],-1)),u("p",{class:c("mt-1 max-w-2xl text-sm leading-6 "+(d(_).isDarkMode?"text-gray-300":"text-gray-500"))}," 存储健康，提供存储状态监测与优化管理。 ",2)]),n(w,{size:"small",class:"mt-5"},{default:p(()=>[u("div",L,[n(y,null,{default:p(()=>[n(l,{size:"large",clearable:"",value:j.value,"onUpdate:value":t[0]||(t[0]=e=>j.value=e),ref_key:"searchKeyWordInput",ref:q,placeholder:"搜索功能名称",class:"w-4/5"},null,8,["value"]),n(s,{size:"large",type:"primary",onClick:t[1]||(t[1]=()=>{q.value?.blur()})},{icon:p(()=>[n(a,null,{default:p(()=>[n(d(D))]),_:1})]),default:p(()=>[t[4]||(t[4]=u("span",{class:"hidden sm:inline-block"},"搜索",-1))]),_:1,__:[4]}),n(s,{size:"large",bordered:"",onClick:t[2]||(t[2]=()=>{j.value=""})},{icon:p(()=>[n(a,null,{default:p(()=>[n(d(C))]),_:1})]),default:p(()=>[t[5]||(t[5]=u("span",{class:"hidden sm:inline-block"},"清空",-1))]),_:1,__:[5]})]),_:1})])]),_:1}),u("div",{class:c("mt-3 border-t "+(d(_).isDarkMode?"divide-sothx-gray-color border-sothx-gray-color":"divide-gray-200 border-gray-200"))},[u("dl",{class:c("divide-y "+(d(_).isDarkMode?"divide-sothx-gray-color":"divide-gray-200"))},[(i(!0),r(m,null,v(P.value,(e,t)=>(i(),r("div",{key:t,class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},[u("dt",{class:c("text-sm font-medium leading-6 "+(d(_).isDarkMode?"text-white":"text-gray-900"))},[g(h(e.title)+" ",1),e.titleSlot?(i(),b(d(B),{key:0,content:e.titleSlot&&e.titleSlot()},null,8,["content"])):f("",!0)],2),u("dd",{class:c(`mt-1 text-sm leading-6 ${d(_).isDarkMode?"text-gray-300":"text-gray-700"} sm:col-span-2 sm:mt-0`)},[e.content?(i(),b(d(B),{key:0,content:e.content&&e.content()},null,8,["content"])):f("",!0)],2)]))),128))],2)],2)])])}}});export{_ as default};
