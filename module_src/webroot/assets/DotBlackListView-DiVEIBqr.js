import{_ as t}from"./all_app-D39sbeUz.js";import{d as e,u as a,a as l}from"./index-DzSTkKzX.js";import{bq as o,br as s,bz as i,d as n,r,L as c,b as p,ar as u,h as d,aQ as m,Z as g,bx as k,J as f,bu as y,bw as b,c as v,by as L,bv as w,M as x,dT as D,c7 as B,da as T,dU as h,dV as C,aq as _,l as M,db as P,d9 as j,df as S}from"./apis-C7ty3117.js";import{B as I,as as Q,aW as U,x as A,y as z,z as W,av as R,F as N,ak as H,U as O}from"./hooks-2suip5SX.js";import{_ as E}from"./DotBlackListAppDrawer.vue_vue_type_script_setup_true_lang-B1ZhtBdr.js";import{b as K,a as V}from"./format-D_OGebxR.js";import{p as Z}from"./pako-Bb7MnDjl.js";import{r as q}from"./CpuChipIcon-UpwTeNwG.js";import{r as F}from"./PlusIcon-Djq0kevt.js";import{r as J}from"./ArrowPathIcon-Cx2qtqOx.js";import{r as X,a as $,b as G,c as Y}from"./FunnelIcon-Cb4_23V_.js";import{r as tt,a as et}from"./QuestionMarkCircleIcon-Bx4X0C5t.js";import{r as at}from"./ShareIcon-DPOm89M6.js";import{r as lt,a as ot}from"./XCircleIcon-lAboR7LV.js";import"./iconfont-CKH9wMaD.js";import"./lodash-DMrPhC4V.js";function st(t,e){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 8.25V18a2.25 2.25 0 0 0 2.25 2.25h13.5A2.25 2.25 0 0 0 21 18V8.25m-18 0V6a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 6v2.25m-18 0h18M5.25 6h.008v.008H5.25V6ZM7.5 6h.008v.008H7.5V6Zm2.25 0h.008v.008H9.75V6Z"})])}const it={class:"autoui-view mb-10"},nt={class:"mt-3"},rt={class:"mb-3 px-4 sm:px-0"},ct={key:0,class:"mb-3 flex flex-wrap"},pt={class:"flex flex-wrap mt-3"},ut={key:1,"show-icon":!0,class:"mb-3 flex flex-wrap"},dt={class:"mt-3"},mt={class:"flex flex-wrap"},gt={class:"flex flex-wrap"},kt=n({__name:"DotBlackListView",setup(n){const kt=r(null),ft=[{title:"应用名称",minWidth:250,key:"name",render(t,e){const a=new Set(yt.installedAndroidApplicationPackageNameList);return g("div",null,[g("div",{class:"flex"},[a.has(t.name)&&g("img",{class:"mr-1 w-[28px] h-[28px] rounded-full object-cover",src:`ksu://icon/${t.name}`,onError:t=>{t.currentTarget.style.display="none"}},null),yt.canUsePackageInfoApi&&t.name&&g("p",{class:"mt-1"},[S(t.name)]),!yt.canUsePackageInfoApi&&t.applicationName&&g("p",{class:"mt-1"},[t.applicationName])]),t.name&&g("p",null,[g("span",null,[v("(")]),t.name,g("span",null,[v(")")])])])}},{title:"规则状态",width:150,key:"isOptimizeWebView",render:(t,e)=>t.status||Tt.isSupportProjectTrebleCustomDotBlackList&&Tt.isEnableProjectTrebleCustomDotBlackList?g(m("n-tag"),{bordered:!1,dashed:!0,type:"success"},{default:()=>[v("已生效")]}):g(m("n-tag"),{bordered:!1,dashed:!0,type:"info"},{default:()=>[v("未生效")]})},{title:"规则来源",width:150,key:"ruleMode",render(t,e){const a={icon:"custom"===t.ruleMode?Y:et};if("custom"===t.ruleMode){const e=[{label:"分享自定义规则",key:"shareCustomRule",icon:Pt(g("svg",{class:"icon","aria-hidden":"true"},[g("use",{"xlink:href":"#icon-fenxiang"},null)]),20)},{label:"清除自定义规则",key:"cleanCustomRule",icon:Pt(g("svg",{class:"icon","aria-hidden":"true"},[g("use",{"xlink:href":"#icon-qingchu"},null)]),20)}];return g(m("n-dropdown"),{onSelect:(e,a)=>(async(t,e,a)=>{if(Tt.isCanUse||Tt.isSupportProjectTrebleCustomDotBlackList)if(!Tt.isSupportProjectTrebleCustomDotBlackList||Tt.isEnableProjectTrebleCustomDotBlackList){if("cleanCustomRule"===t){const t=Dt.create({title:"想清除自定义规则吗？",type:"warning",preset:"dialog",content:()=>g("p",null,[v("清除自定义规则后，将恢复")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[j(a.name,a.applicationName)])," ",v("的窗口控制器显示效果。确定要继续吗？")]),positiveText:"确定清除",negativeText:"我再想想",onPositiveClick:async()=>{t.loading=!0,Tt.customDotBlackList=Tt.customDotBlackList.filter((t=>t!==a.name)),Tt.sourceDotBlackList=Tt.sourceDotBlackList.map((t=>(t.dataList=t.dataList.filter((t=>t!==a.name)),t)));const e=Tt.mergeDotBlackList.map((t=>t.name)),[l,o]=await x(Tt.isSupportProjectTrebleCustomDotBlackList?h({dotBlackList:e,systemDotBlackList:Tt.projectTrebleSystemDotBlackList,customDotBlackList:Tt.customDotBlackList}):C({dotBlackList:e,sourceDotBlackList:Tt.sourceDotBlackList,customDotBlackList:Tt.customDotBlackList}));l?(Dt.create({title:"清除自定义规则失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("发生异常错误，清除失败了QwQ，详细错误请查看错误日志~")])}),t.loading=!1):(t.loading=!1,Dt.create({title:"清除自定义规则成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("好耶w，清除自定义规则成功了OwO~实际生效还需要重启")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("系统界面")])," ",v("的作用域，确定要继续吗？")]),positiveText:"确定重启作用域",negativeText:"稍后手动重启",onPositiveClick(){B().then((async t=>{await jt(),Dt.create({title:"重启作用域成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("已经成功为你重启系统界面的作用域，请查看是否生效，如不生效请手动重启平板再查看效果~")])})})).catch((t=>{Dt.create({title:"重启作用域失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("发生异常错误，重启系统界面作用域失败QwQ，详细错误请查看日志~")])})}))}}),t.loading=!1,await jt())}})}if("shareCustomRule"===t){const t={name:a.name,cmpt:1,rules:{name:a.name},type:"dot_black_list",device:"tablet"===yt.deviceType?"pad":"fold"},e=JSON.stringify(t),l=Z.deflate(e,{level:9,memLevel:9,windowBits:15}),o=new Uint8Array(l),s=V(o),[i]=await x(navigator.clipboard.writeText(`我分享了一个[窗口控制器]的自定义规则，可以前往[完美横屏应用计划 For Web UI]导入：\n${s}`));if(i)return void Dt.create({title:"复制分享口令失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("复制")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[j(a.name,a.applicationName)])," ",v("的分享口令失败了QwQ，可能由于没有读取/写入剪切板的权限或")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("自定义规则")])," ",v("长度过大。")]),positiveText:"确定"});Dt.create({title:"复制分享口令成功",type:"success",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("好耶w，复制")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[j(a.name,a.applicationName)])," ",v("分享口令成功了~")]),g("p",null,[v("如果没有复制成功，请确认是否给予了读取/写入剪切板的权限或")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("自定义规则")])," ",v("长度过大。")]),g("p",null,[v("分享口令导入入口位于")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("窗口控制器- 从分享口令导入")])," ",v("。")])]),positiveText:"确定"})}}else Dt.create({title:"未激活 窗口控制器 3.0",type:"warning",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("未激活窗口控制器 3.0，先激活功能才能使用哦~")])])});else Dt.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")]),"Magisk"!==yt.currentRootManager&&g("p",null,[v("部分"),yt.currentRootManager,v("版本内置的Web UI存在异常，如仍然无法正常获取云控数据库，请单独安装模块网盘内提供的KsuWebUI。")])])})})(e,0,t),size:"large",trigger:"click",options:e},{default:()=>[g(m("n-button"),{size:"small",dashed:!0,type:"info"},{default:()=>[v("自定义规则")],...a})]})}return g(m("n-button"),{size:"small",dashed:!0,type:"error",onClick:()=>(t=>{Dt.create({title:"系统规则说明",type:"warning",preset:"dialog",content:()=>g("p",null,[v("系统已对")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[j(t.name,t.applicationName)])," ",v("配置了窗口控制器的隐藏，且不可被移除，仅有自定义规则可以被移除哦~")])})})(t)},{default:()=>[v("系统规则")],...a})}}],yt=c(),bt=I(),vt=Q(),Lt=U(),wt=p((()=>({theme:yt.isDarkMode?A:z}))),{message:xt,modal:Dt,notification:Bt}=W(["message","modal","notification"],{configProviderProps:wt}),Tt=e(),ht=r(!1),Ct=r(!1);R();const _t=r(null);a(),u(),l();const Mt=r("");function Pt(t,e){return()=>M(H,{size:e},{default:()=>M(t)})}const jt=async()=>{Tt.isCanUse||Tt.isSupportProjectTrebleCustomDotBlackList?!Tt.isSupportProjectTrebleCustomDotBlackList||Tt.isEnableProjectTrebleCustomDotBlackList?(await yt.getAndroidApplicationPackageNameList(),await Tt.initDefault()):Dt.create({title:"未激活 窗口控制器 3.0",type:"warning",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("未激活窗口控制器 3.0，先激活功能才能使用哦~")])])}):Dt.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")]),"Magisk"!==yt.currentRootManager&&g("p",null,[v("部分"),yt.currentRootManager,v("版本内置的Web UI存在异常，如仍然无法正常获取云控数据库，请单独安装模块网盘内提供的KsuWebUI。")])])})},St=()=>{Tt.filterInstalledApps=!Tt.filterInstalledApps},It=async()=>{if(Tt.isCanUse||Tt.isSupportProjectTrebleCustomDotBlackList)if(!Tt.isSupportProjectTrebleCustomDotBlackList||Tt.isEnableProjectTrebleCustomDotBlackList){if(_t.value){const[t,e]=await x(_t.value.openDrawer());if(t)console.log("操作取消:",t);else{Tt.customDotBlackList.push(e.name);const t=Tt.mergeDotBlackList.map((t=>t.name)),[a,l]=await x(Tt.isSupportProjectTrebleCustomDotBlackList?h({dotBlackList:t,systemDotBlackList:Tt.projectTrebleSystemDotBlackList,customDotBlackList:Tt.customDotBlackList}):C({dotBlackList:t,sourceDotBlackList:Tt.sourceDotBlackList,customDotBlackList:Tt.customDotBlackList}));a?(Dt.create({title:"应用添加失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("发生异常错误，添加失败了QwQ，详细错误请查看错误日志~")])}),e.loadingCallback&&e.loadingCallback()):(Dt.create({title:"应用添加成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("好耶w，已经成功配置")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[j(e.name,yt.installedAppNameList[e.name]||Tt.applicationName[e.name])])," ",v("的窗口控制器隐藏效果了OwO~实际生效还需要重启")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("系统界面")])," ",v("的作用域，确定要继续吗？")]),positiveText:"确定重启作用域",negativeText:"稍后手动重启",onPositiveClick(){B().then((async t=>{await jt(),Dt.create({title:"重启作用域成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("已经成功为你重启系统界面的作用域，请查看是否生效，如不生效请手动重启平板再查看效果~")])})})).catch((t=>{Dt.create({title:"重启作用域失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("发生异常错误，重启系统界面作用域失败QwQ，详细错误请查看日志~")])})}))}}),await jt(),e.loadingCallback&&e.loadingCallback(),e.closeCallback&&e.closeCallback())}}}else Dt.create({title:"未激活 窗口控制器 3.0",type:"warning",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("未激活窗口控制器 3.0，先激活功能才能使用哦~")])])});else Dt.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")]),"Magisk"!==yt.currentRootManager&&g("p",null,[v("部分"),yt.currentRootManager,v("版本内置的Web UI存在异常，如仍然无法正常获取云控数据库，请单独安装模块网盘内提供的KsuWebUI。")])])})},Qt=d({page:1,pageSize:10,simple:!0,showSizePicker:!0,onChange:t=>{Qt.page=t},onUpdatePageSize:t=>{Qt.pageSize=t,Qt.page=1}}),Ut=({focused:t,checked:e})=>{const a={};return e?(a.background="#2080f0",t&&(a.boxShadow="0 0 0 2px #2080f040")):(a.background="#d03050",t&&(a.boxShadow="0 0 0 2px #d0305040")),a};return(e,a)=>{const l=m("n-alert"),n=m("n-skeleton"),r=m("n-switch"),c=m("n-input-group"),p=m("n-card"),u=m("n-data-table");return s(),o("main",it,[i("div",nt,[i("div",rt,[a[11]||(a[11]=i("h3",{class:k("text-base font-semibold leading-7")},[i("span",{class:"animated-bg bg-clip-text font-semibold text-transparent",style:{"background-image":"linear-gradient(\r\n\t\t\t\t\t\t\t\t101.22deg,\r\n\t\t\t\t\t\t\t\trgb(255, 182, 133) -18.32%,\r\n\t\t\t\t\t\t\t\trgb(255, 111, 29) 7.01%,\r\n\t\t\t\t\t\t\t\trgb(252, 181, 232) 41.59%,\r\n\t\t\t\t\t\t\t\trgb(135, 148, 255) 70.98%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 91.35%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 110.17%\r\n\t\t\t\t\t\t\t)"}},"窗口控制器")],-1)),i("p",{class:k("mt-1 max-w-2xl text-sm leading-6 "+(f(yt).isDarkMode?"text-gray-300":"text-gray-500"))}," 窗口控制器，控制应用顶栏窗口控制器的显示或隐藏。 ",2)])]),g(p,{size:"small"},{default:y((()=>[!1===f(Tt).isSupportProjectTrebleCustomDotBlackList?(s(),o("div",ct,[g(l,{"show-icon":!1,type:"warning"},{default:y((()=>[a[13]||(a[13]=i("p",null,"本功能通过覆盖小米云控规则实现，基于此方案实现的效果并不稳定，容易被小米云控覆盖。",-1)),a[14]||(a[14]=i("p",null,"通过 附加模块 激活窗口控制器 3.0，可以不再再受小米云控覆盖影响：",-1)),i("div",pt,[g(f(N),{size:"small",onClick:a[0]||(a[0]=()=>f(Lt).openDownloadModuleModal()),color:"#69b2b6"},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(q))])),_:1})])),default:y((()=>[a[12]||(a[12]=v(" 获取附加模块 "))])),_:1,__:[12]})])])),_:1,__:[13,14]})])):b("",!0),!0===f(Tt).isSupportProjectTrebleCustomDotBlackList?(s(),o("div",ut,[g(l,{"show-icon":!1,type:"success"},{default:y((()=>[i("p",null,"您的 "+L(f(yt).isInstalledXiaomiPadSystemPatchAdditionalModule?"附加模块":"移植包")+" 已适配窗口控制器 3.0，激活后将可以自由控制应用顶栏窗口控制器的显示或隐藏，且不受小米云控影响。",1),i("div",dt,[f(Tt).isInit?(s(),w(r,{key:1,"rail-style":Ut,value:f(Tt).isEnableProjectTrebleCustomDotBlackList,loading:f(yt).loading||f(Tt).loading,"onUpdate:value":a[1]||(a[1]=async t=>{const[e]=await f(x)(D(t?1:0));e?f(Dt).create({title:"更新激活状态失败",type:"error",preset:"dialog",content:()=>"更新激活状态失败，出现未知异常，详细请查看日志~",positiveText:"确定"}):(f(Tt).isEnableProjectTrebleCustomDotBlackList=t,f(Dt).create({title:"更新激活状态成功",type:"success",preset:"dialog",content:()=>f(Tt).isEnableProjectTrebleCustomDotBlackList?"已成功激活窗口控制器 3.0，可以自定义更多应用的窗口控制器了~实际生效还需要重载系统界面作用域，是否继续？":"已成功禁用窗口控制器 3.0，仅使用系统内置的黑名单规则~实际生效还需要重载系统界面作用域，是否继续？",positiveText:"确定重载作用域",negativeText:"稍后再说",async onPositiveClick(){const[t]=await f(x)(B());t&&f(Dt).create({title:"操作失败",type:"error",preset:"dialog",content:()=>"无法重启系统界面作用域，详情请查看日志记录~",positiveText:"确定"})}}))})},{checked:y((()=>a[15]||(a[15]=[v("已激活 窗口控制器 3.0")]))),unchecked:y((()=>a[16]||(a[16]=[v("未激活 窗口控制器 3.0")]))),_:1},8,["value","loading"])):(s(),w(n,{key:0,width:160,sharp:!1,round:"",size:"small"}))])])),_:1})])):b("",!0),i("div",mt,[g(f(N),{class:"mb-3 mr-3",type:"info",loading:f(yt).loading||f(Tt).loading,onClick:It},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(F))])),_:1})])),default:y((()=>[a[17]||(a[17]=v(" 添加应用 "))])),_:1,__:[17]},8,["loading"]),g(f(N),{class:"mb-3 mr-3",type:"success",loading:f(yt).loading||f(Tt).loading,onClick:a[2]||(a[2]=()=>jt())},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(J))])),_:1})])),default:y((()=>[a[18]||(a[18]=v(" 刷新应用列表 "))])),_:1,__:[18]},8,["loading"]),g(f(N),{class:"mb-3 mr-3",color:"#8a2be2",loading:f(yt).loading||f(Tt).loading,onClick:a[3]||(a[3]=()=>(async()=>{if(!Tt.isCanUse&&!Tt.isSupportProjectTrebleCustomDotBlackList)return void Dt.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")]),"Magisk"!==yt.currentRootManager&&g("p",null,[v("部分"),yt.currentRootManager,v("版本内置的Web UI存在异常，如仍然无法正常获取云控数据库，请单独安装模块网盘内提供的KsuWebUI。")])])});if(Tt.isSupportProjectTrebleCustomDotBlackList&&!Tt.isEnableProjectTrebleCustomDotBlackList)return void Dt.create({title:"未激活 窗口控制器 3.0",type:"warning",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("未激活窗口控制器 3.0，先激活功能才能使用哦~")])])});Ct.value=!0,await jt();const t=Tt.mergeDotBlackList.map((t=>t.name)),[e,a]=await x(Tt.isSupportProjectTrebleCustomDotBlackList?h({dotBlackList:t,systemDotBlackList:Tt.projectTrebleSystemDotBlackList,customDotBlackList:Tt.customDotBlackList}):C({dotBlackList:t,sourceDotBlackList:Tt.sourceDotBlackList,customDotBlackList:Tt.customDotBlackList}));e&&(Dt.create({title:"热重载应用数据失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("热重载应用数据失败了QwQ，详情请查看错误日志~")]),positiveText:"确定"}),Ct.value=!1),a&&(Dt.create({title:"热重载应用数据成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("好耶w，已经重新为你载入包括自定义规则在内的应用数据~实际生效还需要重启")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("系统界面")])," ",v("的作用域，确定要继续吗？")]),positiveText:"确定重启作用域",negativeText:"稍后手动重启",onPositiveClick(){B().then((async t=>{await jt(),Dt.create({title:"重启作用域成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("已经成功为你重启系统界面的作用域，请查看是否生效，如不生效请手动重启平板再查看效果~")])})})).catch((t=>{Dt.create({title:"重启作用域失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("发生异常错误，重启系统界面作用域失败QwQ，详细错误请查看日志~")])})}))}}),Ct.value=!1)})())},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(X))])),_:1})])),default:y((()=>[a[19]||(a[19]=v(" 热重载应用数据 "))])),_:1,__:[19]},8,["loading"]),f(yt).canUsePackageInfoApi?b("",!0):(s(),w(f(N),{key:0,class:"mb-3 mr-3",color:"#69b2b6",loading:f(yt).loading||f(Tt).loading||f(vt).loading.value,onClick:a[4]||(a[4]=t=>(async()=>{const[t,e]=await x(vt.getList());t&&Dt.create({title:"获取失败",type:"warning",preset:"dialog",content:()=>g("p",null,[v("您的系统环境暂不支持该功能，获取失败~")]),positiveText:"确定"}),e&&Dt.create({title:"获取成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("好耶OwO，已重新获取当前已安装的应用名称~")]),positiveText:"确定"})})())},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(tt))])),_:1})])),default:y((()=>[a[20]||(a[20]=v(" 获取已安装应用名称 "))])),_:1,__:[20]},8,["loading"])),g(f(N),{class:"mb-3 mr-3",type:"warning",loading:f(yt).loading||f(Tt).loading||ht.value,onClick:a[5]||(a[5]=t=>(async()=>{if(!Tt.isCanUse&&!Tt.isSupportProjectTrebleCustomDotBlackList)return void Dt.create({title:"获取云控失败",type:"error",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("无法获取到HTML查看器的云控，请检查是否禁用云控或者清除HTML查看器的数据再重启平板尝试操作~")]),"Magisk"!==yt.currentRootManager&&g("p",null,[v("部分"),yt.currentRootManager,v("版本内置的Web UI存在异常，如仍然无法正常获取云控数据库，请单独安装模块网盘内提供的KsuWebUI。")])])});if(Tt.isSupportProjectTrebleCustomDotBlackList&&!Tt.isEnableProjectTrebleCustomDotBlackList)return void Dt.create({title:"未激活 窗口控制器 3.0",type:"warning",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("未激活窗口控制器 3.0，先激活功能才能使用哦~")])])});Mt.value="";const[,t]=await x(new Promise(((t,e)=>{Dt.create({title:"请粘贴分享口令",preset:"dialog",style:"min-width:500px; width:50%;",class:"responsive-modal",content:()=>M(O,{type:"textarea",value:Mt.value,"onUpdate:value":t=>{Mt.value=t},autosize:{minRows:8,maxRows:8},placeholder:"在此处粘贴分享规则口令"}),positiveText:"确定提交",negativeText:"取消导入",onPositiveClick(){t("positiveClick")}})})));if(t){ht.value=!0;const t=Mt.value,a=P(t);if(!(null==a?void 0:a.length))return Dt.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("导入分享规则失败了QwQ，解析")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("自定义规则")])," ",v("口令发生错误，无法正常解析。")]),positiveText:"确定"}),void(ht.value=!1);try{const t=K(a),e=Z.inflate(t,{to:"string"}),l=JSON.parse(e);if("dot_black_list"!==l.type)return Dt.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("导入分享规则失败了QwQ，该")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("自定义规则")])," ",v("不适用于窗口控制器。")]),positiveText:"确定"}),void(ht.value=!1);if("pad"===l.device&&"tablet"!==yt.deviceType||"fold"===l.device&&"tablet"===yt.deviceType)return Dt.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("导入分享规则失败了QwQ，平板和折叠屏的适配规则不能混用哦~")]),positiveText:"确定"}),void(ht.value=!1);if(Tt.allPackageName.has(l.name))return Dt.create({title:"应用包名已存在",type:"error",preset:"dialog",content:()=>g("p",null,[v("这个应用包名已经存在列表中了,导入分享规则失败了！（敲")])}),void(ht.value=!1);Tt.customDotBlackList.push(l.name);const o=Tt.mergeDotBlackList.map((t=>t.name)),[s,i]=await x(Tt.isSupportProjectTrebleCustomDotBlackList?h({dotBlackList:o,systemDotBlackList:Tt.projectTrebleSystemDotBlackList,customDotBlackList:Tt.customDotBlackList}):C({dotBlackList:o,sourceDotBlackList:Tt.sourceDotBlackList,customDotBlackList:Tt.customDotBlackList}));s?(Dt.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("发生异常错误，导入失败了QwQ，详细错误请查看错误日志~")])}),ht.value=!1):(await jt(),bt.updateMergeRuleList(),ht.value=!1,Dt.create({title:"导入分享规则成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("好耶w，")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[j(l.name,yt.installedAppNameList[l.name]||bt.applicationName[l.name])])," ",v("的应用配置成功了OwO~实际生效还需要重启")," ",g("span",{class:"font-bold "+(yt.isDarkMode?"text-teal-400":"text-gray-600")},[v("系统界面")])," ",v("的作用域，确定要继续吗？")]),positiveText:"确定重启作用域",negativeText:"稍后手动重启",onPositiveClick(){B().then((async t=>{await jt(),Dt.create({title:"重启作用域成功",type:"success",preset:"dialog",content:()=>g("p",null,[v("已经成功为你重启系统界面的作用域，请查看是否生效，如不生效请手动重启平板再查看效果~")])})})).catch((t=>{Dt.create({title:"重启作用域失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("发生异常错误，重启系统界面作用域失败QwQ，详细错误请查看日志~")])})}))}}))}catch(e){console.log(e,"error"),Dt.create({title:"导入分享规则失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("解析分享规则失败了QwQ，请检查导入口令是否有误")]),positiveText:"确定"}),ht.value=!1}}})())},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(at))])),_:1})])),default:y((()=>[a[21]||(a[21]=v(" 从分享口令导入 "))])),_:1,__:[21]},8,["loading"]),f(Tt).isSupportProjectTrebleCustomDotBlackList?b("",!0):(s(),w(f(N),{key:1,class:"mb-3 mr-3",type:"error",loading:f(yt).loading||f(Tt).loading||ht.value,onClick:a[6]||(a[6]=t=>(async()=>{const[t,e]=await x(new Promise(((t,e)=>{Dt.create({title:"想重启设备吗？",type:"info",preset:"dialog",content:()=>g("div",null,[g("p",null,[v("是否立即重启设备，以使规则生效？")])]),positiveText:"确认重启",negativeText:"取消",onPositiveClick:()=>{t("positiveClick")},onNegativeClick:()=>{e("negativeClick")}})})));if(e){const[t]=await x(_());if(t)return void Dt.create({title:"操作失败",type:"error",preset:"dialog",content:()=>g("p",null,[v("无法重启设备，详情请查看日志记录~")]),positiveText:"确定"})}})())},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(st))])),_:1})])),default:y((()=>[a[22]||(a[22]=v(" 重启设备 "))])),_:1,__:[22]},8,["loading"]))]),i("div",gt,[g(f(N),{class:"mb-3 mr-3",type:f(Tt).filterInstalledApps?"success":"info",strong:"",loading:f(yt).loading||f(Tt).loading,secondary:"",onClick:St},{icon:y((()=>[g(f(H),null,{default:y((()=>[f(Tt).filterInstalledApps?(s(),w(f($),{key:0})):(s(),w(f(G),{key:1}))])),_:1})])),default:y((()=>[v(" "+L(f(Tt).filterInstalledApps?"已安装应用":"全部应用"),1)])),_:1},8,["type","loading"]),g(f(N),{class:"mb-3 mr-3",type:"warning",secondary:"",loading:f(yt).loading||f(Tt).loading,onClick:a[7]||(a[7]=()=>T())},{icon:y((()=>[g(f(H),null,{default:y((()=>a[23]||(a[23]=[i("img",{src:t},null,-1)]))),_:1,__:[23]})])),default:y((()=>[a[24]||(a[24]=v(" 应用抽屉 "))])),_:1,__:[24]},8,["loading"])]),g(c,null,{default:y((()=>[g(f(O),{size:"large",clearable:"",value:f(Tt).searchKeyWord,"onUpdate:value":a[8]||(a[8]=t=>f(Tt).searchKeyWord=t),ref_key:"searchKeyWordInput",ref:kt,placeholder:"搜索应用名称/应用包名",style:{width:"80%"}},null,8,["value"]),g(f(N),{size:"large",type:"primary",onClick:a[9]||(a[9]=()=>{var t;null==(t=kt.value)||t.blur()})},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(lt))])),_:1})])),default:y((()=>[a[25]||(a[25]=i("span",{class:"hidden sm:inline-block"},"搜索",-1))])),_:1,__:[25]}),g(f(N),{size:"large",bordered:"",onClick:a[10]||(a[10]=()=>{f(Tt).searchKeyWord=""})},{icon:y((()=>[g(f(H),null,{default:y((()=>[g(f(ot))])),_:1})])),default:y((()=>[a[26]||(a[26]=i("span",{class:"hidden sm:inline-block"},"搜索",-1))])),_:1,__:[26]})])),_:1})])),_:1}),g(u,{size:"small",loading:f(yt).loading||f(Tt).loading,columns:f(ft),class:"mt-3",data:f(Tt).filterMergeDotBlackList,pagination:Qt},null,8,["loading","columns","data","pagination"]),g(E,{ref_key:"addDotBlackListApp",ref:_t,type:"add",title:"添加应用"},null,512)])}}});export{kt as default};
