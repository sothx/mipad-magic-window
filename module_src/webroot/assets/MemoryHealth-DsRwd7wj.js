import{d as e,L as t,r as l,b as a,aQ as n,aR as s,aS as o,a_ as r,aW as i,J as u,M as c,aV as d,F as p,bD as m,c as v,aZ as g,aX as b,aY as f,k as h,v as y,cb as S}from"./apis-DMZRtRi-.js";import{ay as w,aC as I,aB as k,aL as x}from"./hooks-dj47jWY7.js";import{R as O}from"./RenderJSX-EhwFgcRO.js";import{r as B,a as D}from"./XCircleIcon-DNc3ifIu.js";import"./lodash-DMrPhC4V.js";const M={class:"memoryHealth"},C={class:"mt-3"},F={class:"px-3 sm:px-0"},L={class:"flex"},E=e({__name:"MemoryHealth",setup(e){const E=t(),R=w(),z=I(),A=k(),U=x(),_=l(""),V=l(null),T=({focused:e,checked:t})=>{const l={};return t?(l.background="#d03050",e&&(l.boxShadow="0 0 0 2px #d0305040")):(l.background="#2080f0",e&&(l.boxShadow="0 0 0 2px #2080f040")),l},W=[{title:"设备DDR和UFS信息",content:()=>c("div",{class:"whitespace-pre"},[E.deviceInfo.memoryInfo||"获取失败"]),isShow:()=>Boolean(E.deviceInfo.memoryInfo)},{title:"设备DDR生产厂商",content:()=>c("div",{class:"whitespace-pre"},[E.DDRVendor]),isShow:()=>Boolean(E.DDRVendor)},{title:"ZRAM Writeback",content:()=>c(p,null,[c("div",{class:"mb-3"},[c(n("n-tag"),null,{default:()=>[v("dm设备映射器: "),R.miuiExtmDmOptEnable.value?"启用":"未启用"]})]),c("div",{class:"mb-3"},[c(n("n-tag"),{type:"error"},{default:()=>[v("回写块: "),R.backingDev.value,v(" ")]})]),c("div",{class:"mb-3"},[c(n("n-tag"),{type:"success"},{default:()=>[v("已回写: "),R.hasWriteBack.value,v(" MB")]})]),c("div",{class:"mb-3"},[c(n("n-tag"),{type:"info"},{default:()=>[v("总读取: "),R.totalRead.value,v(" MB")]})]),c("div",null,[c(n("n-tag"),{type:"warning"},{default:()=>[v("总回写: "),R.totalWriteBack.value,v(" MB")]})]),c(n("n-alert"),{class:"mt-5",type:"warning","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[v("通常用于将设备上的冷数据压缩并迁移到磁盘上，是基于「内存扩展」的回写块，该功能依赖「内存扩展」，请确保已经开启「内存扩展」，总回写可以大于「内存扩展」，初始状态下显示 0 MB是正常现象，请持续使用一段时间再观察是否有变化")])]})]),isShow:()=>Boolean(E.MIOSVersion&&E.MIOSVersion>=2&&E.androidTargetSdk>=35&&R.isInit.value)},{title:"智能IO调度",content:()=>{const e=(()=>{const e=A.currentScheduler.value,t=A.smartFocusIO.value,l=A.currentPropScheduler.value;return"cpq"===e?"success":"on"===t&&l&&"cpq"!==l?"warning":"error"})();return c(p,null,[c(n("n-tag"),{type:e},{default:()=>["success"===e?"已启用智能IO调度 [cpq]":"warning"===e?`已被模块磁盘IO调度覆盖 [${A.currentScheduler.value}]`:"未启用智能IO调度"]}),c(n("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[v("「智能IO调度 cpq」是小米基于「Linux磁盘IO调度 bfq」二次优化改进的版本，一般情况下建议启用，可以一定程度提升系统的IO性能体验。")])]}),A.isNeedShowModuleTips.value&&c(n("n-alert"),{class:"mt-5",type:"warning","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[v("您当前未启用「智能IO调度」，由于小米「磁盘IO调度」BUG，骁龙8+Gen1机型存在IO调度异常的问题， 容易导致系统卡顿或者无响应，您可以通过安装「精选应用-系统功能补全模块」来启用「智能IO调度」，提升系统IO性能体验。")])]})])},isShow:()=>Boolean(A.isSupportSmartFocusIO.value)},{title:"磁盘IO调度策略",content:()=>c(p,null,[c("div",{class:"grid grid-cols-2 gap-4 sm:px-0"},[Array.isArray(A.schedulerList.value)&&A.schedulerList.value.map(((e,t)=>{const l=e=>{const t=A.currentScheduler.value,l=A.currentPropScheduler.value;return l||t!==e?l===e&&t===e?"success":l&&t&&l!==t&&t===e?"warning":"info":"error"},a=l(e);return c(n("n-alert"),{size:"small","show-icon":!1,type:l(e),title:e,class:"w-full"},{default:()=>[["error"].includes(a)?c(n("n-tag"),{class:"mt-2",bordered:!1,type:a},{default:()=>[c("div",null,[v("系统默认磁盘调度")])]}):h(c(n("n-button"),{class:"mt-2",strong:!0,secondary:!0,type:a,loading:E.loading||A.loading.value,size:"small",onClick:()=>A.changeIOScheduler(e)},{default:()=>["success"===a?"已应用该配置":"warning"===a?"异常的磁盘调度":"应用配置"]}),[[y,A.isInit.value]])]})}))]),c(n("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[v("这里会显示系统所支持的所有磁盘IO调度策略，方便您灵活切换设备的磁盘IO调度策略")]),c("p",null,[v("(受系统实际支持情况影响，切换其他磁盘IO调度策略可能会导致系统出现未知异常，请自行准备救砖模块)")])]})]),isShow:()=>Boolean(A.isShowList.value)},{title:"UFS 存储健康",content:()=>c(p,null,[c("div",{class:"mb-3"},[z.correctedPreEOLStatus.value&&c("div",{class:"mb-3"},[c(n("n-tag"),{type:"info"},{default:()=>[v("寿命阶段: "),z.correctedPreEOLStatus.value]})]),z.deviceLifeTimeEstA.value&&c("div",{class:"mb-3"},[c(n("n-tag"),{type:"success"},{default:()=>[v("用户数据区(已磨损): "),z.deviceLifeTimeEstA.value]})]),z.deviceLifeTimeEstB.value&&c("div",{class:"mb-3"},[c(n("n-tag"),{type:"warning"},{default:()=>[v("高速缓存区(已磨损): "),z.deviceLifeTimeEstB.value]})])]),c(n("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[v("数据仅供参考，通常仅代表当前 UFS 存储设备循环擦写次数与预期设计寿命的比值，不代表 UFS 存储设备的实际磨损状况，但仍然建议当前 UFS 存储设备接近预期设计寿命时选择更换存储设备。")])]})]),isShow:()=>Boolean(z.isShow.value)},{title:"焕新存储",content:()=>c(p,null,[c(n("n-button"),{size:"small",type:"info",secondary:!0,loading:E.loading,onClick:()=>S()},{default:()=>[v("打开 焕新存储信息面板")]}),c(n("n-alert"),{class:"mb-5 mt-5",type:"success","show-icon":!1,bordered:!1},{default:()=>[c("div",null,[c("p",null,[v("焕新存储启用状态:"),c(n("n-button"),{size:"tiny",class:"ml-3",type:U.fboEnable.value?"success":"error",loading:E.loading,onClick:()=>U.handleEnableFbo()},{default:()=>[U.fboEnable.value?"已启用":"未启用(点击启用)"]})]),c("p",null,[v("启用状态通常由小米云控控制，模块支持强制启用焕新存储，但该功能受系统底层支持情况而异，不支持的设备即使启用也不会生效。")]),c(n("n-switch"),{onUpdateValue:e=>U.changeIsAutoEnableFbo(e),"rail-style":T,value:!!U.isAutoStartFbo.value,loading:E.loading},{checked:()=>c(p,null,[v("已强制启用焕新存储")]),unchecked:()=>c(p,null,[v("跟随系统默认云控规则")])})])]}),c(n("n-alert"),{class:"mt-5",type:"info","show-icon":!1,bordered:!1},{default:()=>[c("p",null,[v("焕新存储激活状态:"),c(n("n-button"),{size:"tiny",class:"ml-3",type:U.fboServiceCtrl.value?"success":"error",loading:E.loading,onClick:()=>U.handleEnableFboServiceCtrl()},{default:()=>[U.fboServiceCtrl.value?"已激活":"未激活(点击激活)"]})]),U.fboInstalld.value&&c("p",{class:"mt-1"},[v("焕新存储运行状态:"),c(n("n-tag"),{size:"small",class:"ml-3",type:"info",loading:E.loading,onClick:()=>{}},{default:()=>[U.fboInstalld.value]})]),c("p",null,[v("激活后仍然需要满足以下条件才会在特定时间触发焕新存储：")]),c("p",null,[v("①夜间12点半-凌晨5点")]),c("p",null,[v("②息屏状态")]),c("p",null,[v("③电量大于75%(或保持手机充电)")]),c("p",null,[v("④电池温度小于40℃")]),c("p",null,[v("进行焕新存储期间检测到其中任意条件不满足，焕新存储会被中断，待满足后继续执行，当满足上述4个条件后，此功能也并不是每天都生效，需要文件碎片累积到一定程度会主动进行。")]),c("p",null,[v("（焕新存储流程结束后，激活状态会被关闭，您可以前往Web UI 重新激活）")]),c(n("n-switch"),{onUpdateValue:e=>U.changeIsAutoRegularlyFbo(e),"rail-style":T,value:!!U.isAutoRegularlyFbo.value,loading:E.loading},{checked:()=>c(p,null,[v("已启用每日闲时维护")]),unchecked:()=>c(p,null,[v("未启用每日闲时维护")])})]})]),isShow:()=>Boolean(U.isInit.value)}],j=a((()=>{const e=_.value.trim().toLowerCase();return W.filter((t=>!(t.isShow&&!t.isShow())&&(!e||t.title.toLowerCase().includes(e))))}));return(e,t)=>{const l=n("n-input"),a=n("n-icon"),h=n("n-button"),y=n("n-input-group"),S=n("n-card");return s(),o("div",M,[r("div",C,[r("div",F,[t[3]||(t[3]=r("h3",{class:i("text-base font-semibold leading-7")},[r("span",{class:"animated-bg bg-clip-text font-semibold text-transparent",style:{"background-image":"linear-gradient(\r\n\t\t\t\t\t\t\t\t101.22deg,\r\n\t\t\t\t\t\t\t\trgb(255, 182, 133) -18.32%,\r\n\t\t\t\t\t\t\t\trgb(255, 111, 29) 7.01%,\r\n\t\t\t\t\t\t\t\trgb(252, 181, 232) 41.59%,\r\n\t\t\t\t\t\t\t\trgb(135, 148, 255) 70.98%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 91.35%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 110.17%\r\n\t\t\t\t\t\t\t)"}},"存储健康")],-1)),r("p",{class:i("mt-1 max-w-2xl text-sm leading-6 "+(u(E).isDarkMode?"text-gray-300":"text-gray-500"))}," 存储健康，提供存储状态监测与优化管理。 ",2)]),c(S,{size:"small",class:"mt-5"},{default:d((()=>[r("div",L,[c(y,null,{default:d((()=>[c(l,{size:"large",clearable:"",value:_.value,"onUpdate:value":t[0]||(t[0]=e=>_.value=e),ref_key:"searchKeyWordInput",ref:V,placeholder:"搜索功能名称",class:"w-4/5"},null,8,["value"]),c(h,{size:"large",type:"primary",onClick:t[1]||(t[1]=()=>{var e;null==(e=V.value)||e.blur()})},{icon:d((()=>[c(a,null,{default:d((()=>[c(u(B))])),_:1})])),default:d((()=>[t[4]||(t[4]=r("span",{class:"hidden sm:inline-block"},"搜索",-1))])),_:1}),c(h,{size:"large",bordered:"",onClick:t[2]||(t[2]=()=>{_.value=""})},{icon:d((()=>[c(a,null,{default:d((()=>[c(u(D))])),_:1})])),default:d((()=>[t[5]||(t[5]=r("span",{class:"hidden sm:inline-block"},"清空",-1))])),_:1})])),_:1})])])),_:1}),r("div",{class:i("mt-3 border-t "+(u(E).isDarkMode?"divide-sothx-gray-color border-sothx-gray-color":"divide-gray-200 border-gray-200"))},[r("dl",{class:i("divide-y "+(u(E).isDarkMode?"divide-sothx-gray-color":"divide-gray-200"))},[(s(!0),o(p,null,m(j.value,((e,t)=>(s(),o("div",{key:t,class:"px-4 py-6 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},[r("dt",{class:i("text-sm font-medium leading-6 "+(u(E).isDarkMode?"text-white":"text-gray-900"))},[v(g(e.title)+" ",1),e.titleSlot?(s(),b(u(O),{key:0,content:e.titleSlot&&e.titleSlot()},null,8,["content"])):f("",!0)],2),r("dd",{class:i(`mt-1 text-sm leading-6 ${u(E).isDarkMode?"text-gray-300":"text-gray-700"} sm:col-span-2 sm:mt-0`)},[e.content?(s(),b(u(O),{key:0,content:e.content&&e.content()},null,8,["content"])):f("",!0)],2)])))),128))],2)],2)])])}}});export{E as default};
