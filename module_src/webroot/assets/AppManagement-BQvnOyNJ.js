import{x as t,y as e,z as a,B as n,as as s,au as l,F as i,ak as o,U as r}from"./hooks-Cjt0FqfC.js";import{d as c,r as d,L as p,b as u,ar as m,h as g,aQ as f,bp as b,bq as y,by as x,Z as k,bw as h,J as w,bt as v,c as M,l as _,M as C,di as z,dj as I,d8 as j}from"./apis-C5YtGwyk.js";import{u as A,a as L}from"./index-Blgkmn1L.js";import{a as D}from"./format-D_OGebxR.js";import{p as U}from"./pako-Bb7MnDjl.js";import{r as P}from"./ArrowPathIcon-CeVqAYuL.js";import{r as S,a as T}from"./XCircleIcon-DjdfJQi4.js";import{r as N}from"./EllipsisHorizontalCircleIcon-ChI3FEyu.js";import{r as R}from"./QuestionMarkCircleIcon-ljTCbFgr.js";import"./lodash-CHsIb5BW.js";import"./iconfont-DlUVLeiJ.js";const Q={class:"autoui-view mb-10"},W={class:"mt-3"},K={class:"mb-3 px-4 sm:px-0"},B={class:"flex flex-wrap"},O=c({__name:"AppManagement",setup(c){const O=d(null),X=[{title:"应用名称",width:250,key:"name",render(t,e){const a=new Set(q.installedAndroidApplicationPackageList);return k("div",null,[k("div",{class:"flex"},[a.has(t.name)&&k("img",{class:"mr-1 w-[28px] h-[28px] rounded-full object-cover",src:`ksu://icon/${t.name}`,onError:t=>{t.currentTarget.style.display="none"}},null),k("p",{class:"mt-1"},[t.applicationName?t.applicationName:t.name])]),t.name&&k("p",null,[k("span",null,[M("(")]),t.name,k("span",null,[M(")")])])])}},{title:"应用类型",key:"ruleMode",render(t,e){const a={icon:"custom"===t.ruleMode?N:R};if("custom"===t.ruleMode){const e=[{label:"分享自定义规则",key:"shareCustomRule",icon:Z(k("svg",{class:"icon","aria-hidden":"true"},[k("use",{"xlink:href":"#icon-fenxiang"},null)]),20)},{label:"清除自定义规则",key:"cleanCustomRule",icon:Z(k("svg",{class:"icon","aria-hidden":"true"},[k("use",{"xlink:href":"#icon-qingchu"},null)]),20)}];return k(f("n-dropdown"),{onSelect:(e,a)=>(async(t,e,a)=>{if("cleanCustomRule"===t){const t=J.create({title:"想清除自定义规则吗？",type:"warning",preset:"dialog",content:()=>k("p",null,[M("清除自定义规则后，你对")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[j(a.name,a.applicationName)])," ",M("所做的所有自定义配置将丢失，如果该应用同时还存在")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[M("模块规则")])," ",M("，将会还原回模块自身的适配规则。确定要继续吗？")]),positiveText:"确定清除",negativeText:"我再想想",onPositiveClick:async()=>{t.loading=!0,H.customConfigAutoUIList[a.name]&&delete H.customConfigAutoUIList[a.name];const[e,n]=await C(z({customAutoUIListXML:I(H.customConfigAutoUIList,"package",void 0),settingConfigXML:I(H.autoUISettingConfig,"setting","setting_config")}));e?(J.create({title:"清除自定义规则失败",type:"error",preset:"dialog",content:()=>k("p",null,[M("发生异常错误，更新失败了QwQ，详细错误请查看错误日志~")])}),t.loading=!1):(J.create({title:"清除自定义规则成功",type:"success",preset:"dialog",content:()=>k("p",null,[M("好耶w，清除自定义规则成功了OwO~如果应用更新后的规则不生效，可以尝试重启"),"tablet"===q.deviceType?"平板":"手机",M("再试试~")])}),t.loading=!1,H.updateMergeRuleList())}})}if("shareCustomRule"===t){const t={name:a.name,cmpt:1,rules:{name:a.name,...a.autoUIRule},type:"autoui",device:"tablet"===q.deviceType?"pad":"fold",mode:a.settingMode};console.log(t,"shareContent");const e=JSON.stringify(t),n=U.deflate(e,{level:9,memLevel:9,windowBits:15}),s=new Uint8Array(n),l=D(s),[i]=await C(navigator.clipboard.writeText(`我分享了一个[应用布局优化]的自定义规则，可以前往[完美横屏应用计划 For Web UI]导入：\n${l}`));if(i)return void J.create({title:"复制分享口令失败",type:"error",preset:"dialog",content:()=>k("p",null,[M("复制")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[j(a.name,a.applicationName)])," ",M("的分享口令失败了QwQ，可能由于没有读取/写入剪切板的权限或")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[M("自定义规则")])," ",M("长度过大。")]),positiveText:"确定"});J.create({title:"复制分享口令成功",type:"success",preset:"dialog",content:()=>k("div",null,[k("p",null,[M("好耶w，复制")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[j(a.name,a.applicationName)])," ",M("分享口令成功了~")]),k("p",null,[M("如果没有复制成功，请确认是否给予了读取/写入剪切板的权限或")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[M("自定义规则")])," ",M("长度过大。")]),k("p",null,[M("分享口令导入入口位于")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[M("应用布局优化- 从分享口令导入")])," ",M("。")])]),positiveText:"确定"})}})(e,0,t),size:"large",trigger:"click",options:e},{default:()=>[k(f("n-button"),{size:"small",dashed:!0,type:"info"},{default:()=>[M("自定义规则")],...a})]})}return k(f("n-button"),{size:"small",dashed:!0,type:"error",onClick:()=>(t=>{"module"===t.ruleMode&&J.create({title:"模块规则说明",type:"warning",preset:"dialog",content:()=>k("p",null,[M("模块已对")," ",k("span",{class:"font-bold "+(q.isDarkMode?"text-teal-400":"text-gray-600")},[j(t.name,t.applicationName)])," ",M("配置了合适的适配规则，且不可被移除，仅有自定义规则可以被移除哦~")])})})(t)},{default:()=>[M("模块规则")],...a})}}],q=p(),E=u((()=>({theme:q.isDarkMode?t:e}))),{message:F,modal:J,notification:$}=a(["message","modal","notification"],{configProviderProps:E}),H=n();function Z(t,e){return()=>_(o,{size:e},{default:()=>_(t)})}s(),d(!1),d(!1),l(),d(null),d(null),A(),m(),L(),d("");const G=g({page:1,pageSize:10,simple:!0,showSizePicker:!0,onChange:t=>{G.page=t},onUpdatePageSize:t=>{G.pageSize=t,G.page=1}});return(t,e)=>{const a=f("n-alert"),n=f("n-input-group"),s=f("n-card"),l=f("n-data-table");return y(),b("main",Q,[x("div",W,[x("div",K,[e[4]||(e[4]=x("h3",{class:h("text-base font-semibold leading-7")},[x("span",{class:"animated-bg bg-clip-text font-semibold text-transparent",style:{"background-image":"linear-gradient(\r\n\t\t\t\t\t\t\t\t101.22deg,\r\n\t\t\t\t\t\t\t\trgb(255, 182, 133) -18.32%,\r\n\t\t\t\t\t\t\t\trgb(255, 111, 29) 7.01%,\r\n\t\t\t\t\t\t\t\trgb(252, 181, 232) 41.59%,\r\n\t\t\t\t\t\t\t\trgb(135, 148, 255) 70.98%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 91.35%,\r\n\t\t\t\t\t\t\t\trgb(60, 112, 255) 110.17%\r\n\t\t\t\t\t\t\t)"}},"应用管理增强")],-1)),x("p",{class:h("mt-1 max-w-2xl text-sm leading-6 "+(w(q).isDarkMode?"text-gray-300":"text-gray-500"))}," 支持调整应用启用状态与权限管理能力，实现更灵活的应用控制，提升系统管理效率与使用体验。 ",2)])]),k(s,{size:"small"},{default:v((()=>[k(a,{class:"mb-3","show-icon":!1,type:"warning"},{default:v((()=>e[5]||(e[5]=[x("p",null,"功能正在开发中，敬请期待后续更新。",-1)]))),_:1,__:[5]}),x("div",B,[k(w(i),{class:"mb-3 mr-3",type:"success",loading:w(q).loading||w(H).loading,onClick:e[0]||(e[0]=()=>(async()=>{await q.getAndroidApplicationPackageList(),await q.getInstalledAppPackageInfoList(),await H.initDefault()})())},{icon:v((()=>[k(w(o),null,{default:v((()=>[k(w(P))])),_:1})])),default:v((()=>[e[6]||(e[6]=M(" 刷新应用列表 "))])),_:1,__:[6]},8,["loading"])]),k(n,null,{default:v((()=>[k(w(r),{size:"large",clearable:"",value:w(H).searchKeyWord,"onUpdate:value":e[1]||(e[1]=t=>w(H).searchKeyWord=t),ref_key:"searchKeyWordInput",ref:O,placeholder:"搜索应用名称/应用包名",style:{width:"80%"}},null,8,["value"]),k(w(i),{size:"large",type:"primary",onClick:e[2]||(e[2]=()=>{var t;null==(t=O.value)||t.blur()})},{icon:v((()=>[k(w(o),null,{default:v((()=>[k(w(S))])),_:1})])),default:v((()=>[e[7]||(e[7]=x("span",{class:"hidden sm:inline-block"},"搜索",-1))])),_:1,__:[7]}),k(w(i),{size:"large",bordered:"",onClick:e[3]||(e[3]=()=>{w(H).searchKeyWord=""})},{icon:v((()=>[k(w(o),null,{default:v((()=>[k(w(T))])),_:1})])),default:v((()=>[e[8]||(e[8]=x("span",{class:"hidden sm:inline-block"},"清空",-1))])),_:1,__:[8]})])),_:1})])),_:1}),k(l,{size:"small",loading:w(q).loading||w(H).loading,columns:w(X),class:"mt-3",data:w(H).filterMergeRuleList,pagination:G},null,8,["loading","columns","data","pagination"])])}}});export{O as default};
